<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La B√∫squeda de la Tarea Perdida</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --bg-dark: #1a1a2e;
            --terminal-bg: #0f0f1a;
            --glow-green: #39ff14;
            --glow-cyan: #00fff7;
            --glow-pink: #ff6ec7;
            --glow-yellow: #ffd93d;
            --text-primary: #e8e8e8;
            --text-dim: #8888aa;
            --button-bg: #2d2d44;
            --button-hover: #3d3d5c;
            --border-color: #4a4a6a;
            --scanline-opacity: 0.03;
        }

        body {
            min-height: 100vh;
            background: var(--bg-dark);
            background-image: 
                radial-gradient(ellipse at 20% 20%, rgba(57, 255, 20, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(255, 110, 199, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(0, 255, 247, 0.05) 0%, transparent 70%);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            font-family: 'Fredoka', sans-serif;
        }

        .game-container {
            width: 100%;
            max-width: 700px;
            background: var(--terminal-bg);
            border-radius: 20px;
            border: 3px solid var(--border-color);
            box-shadow: 
                0 0 60px rgba(57, 255, 20, 0.15),
                0 0 100px rgba(0, 255, 247, 0.1),
                inset 0 0 80px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            position: relative;
        }

        /* CRT Scanline Effect */
        .game-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0, 0, 0, var(--scanline-opacity)) 2px,
                rgba(0, 0, 0, var(--scanline-opacity)) 4px
            );
            pointer-events: none;
            z-index: 10;
        }

        /* CRT Flicker Animation */
        .game-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(57, 255, 20, 0.02);
            pointer-events: none;
            z-index: 9;
            animation: flicker 0.15s infinite;
        }

        @keyframes flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.97; }
        }

        .header {
            background: linear-gradient(135deg, #2a2a4a 0%, #1a1a2e 100%);
            padding: 25px 30px;
            border-bottom: 2px solid var(--border-color);
            text-align: center;
            position: relative;
        }

        .header::before {
            content: 'üìö üîç ‚ùì';
            display: block;
            font-size: 1.8rem;
            margin-bottom: 10px;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .title {
            font-family: 'VT323', monospace;
            font-size: clamp(1.8rem, 5vw, 2.5rem);
            color: var(--glow-cyan);
            text-shadow: 
                0 0 10px var(--glow-cyan),
                0 0 20px var(--glow-cyan),
                0 0 40px rgba(0, 255, 247, 0.5);
            letter-spacing: 2px;
            animation: glow-pulse 3s ease-in-out infinite;
        }

        @keyframes glow-pulse {
            0%, 100% { 
                text-shadow: 
                    0 0 10px var(--glow-cyan),
                    0 0 20px var(--glow-cyan),
                    0 0 40px rgba(0, 255, 247, 0.5);
            }
            50% { 
                text-shadow: 
                    0 0 15px var(--glow-cyan),
                    0 0 30px var(--glow-cyan),
                    0 0 60px rgba(0, 255, 247, 0.7);
            }
        }

        .subtitle {
            font-family: 'VT323', monospace;
            font-size: 1rem;
            color: var(--text-dim);
            margin-top: 8px;
            letter-spacing: 1px;
        }

        .story-container {
            padding: 35px 30px;
            min-height: 200px;
        }

        #story-text {
            font-family: 'Fredoka', sans-serif;
            font-size: clamp(1.2rem, 3vw, 1.5rem);
            line-height: 1.8;
            color: var(--text-primary);
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            animation: text-appear 0.5s ease-out;
        }

        @keyframes text-appear {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .choices-container {
            padding: 20px 30px 35px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .choice-btn {
            font-family: 'Fredoka', sans-serif;
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            font-weight: 600;
            padding: 18px 25px;
            background: var(--button-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            text-align: left;
        }

        .choice-btn::before {
            content: '‚ñ∂';
            margin-right: 12px;
            color: var(--glow-green);
            opacity: 0;
            transform: translateX(-10px);
            transition: all 0.3s ease;
            display: inline-block;
        }

        .choice-btn:hover {
            background: var(--button-hover);
            border-color: var(--glow-green);
            transform: translateX(8px);
            box-shadow: 
                0 0 20px rgba(57, 255, 20, 0.2),
                inset 0 0 20px rgba(57, 255, 20, 0.05);
        }

        .choice-btn:hover::before {
            opacity: 1;
            transform: translateX(0);
        }

        .choice-btn:active {
            transform: translateX(8px) scale(0.98);
        }

        /* Different button colors for variety */
        .choice-btn:nth-child(1) { --btn-accent: var(--glow-green); }
        .choice-btn:nth-child(2) { --btn-accent: var(--glow-cyan); }
        .choice-btn:nth-child(3) { --btn-accent: var(--glow-pink); }

        .choice-btn:nth-child(1):hover { border-color: var(--glow-green); box-shadow: 0 0 20px rgba(57, 255, 20, 0.2); }
        .choice-btn:nth-child(2):hover { border-color: var(--glow-cyan); box-shadow: 0 0 20px rgba(0, 255, 247, 0.2); }
        .choice-btn:nth-child(3):hover { border-color: var(--glow-pink); box-shadow: 0 0 20px rgba(255, 110, 199, 0.2); }

        .choice-btn:nth-child(1)::before { color: var(--glow-green); }
        .choice-btn:nth-child(2)::before { color: var(--glow-cyan); }
        .choice-btn:nth-child(3)::before { color: var(--glow-pink); }

        /* Ending styles */
        .ending-bad #story-text {
            border-color: rgba(255, 100, 100, 0.3);
            background: rgba(255, 50, 50, 0.1);
        }

        .ending-good #story-text {
            border-color: rgba(255, 215, 0, 0.3);
            background: rgba(255, 215, 0, 0.1);
            animation: victory-glow 1s ease-in-out infinite alternate;
        }

        @keyframes victory-glow {
            from { box-shadow: 0 0 20px rgba(255, 215, 0, 0.2); }
            to { box-shadow: 0 0 40px rgba(255, 215, 0, 0.4); }
        }

        /* Sound indicator */
        .sound-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--terminal-bg);
            border: 2px solid var(--border-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .sound-indicator:hover {
            border-color: var(--glow-cyan);
            box-shadow: 0 0 15px rgba(0, 255, 247, 0.3);
        }

        .sound-indicator span {
            font-size: 1.5rem;
        }

        /* Decorative elements */
        .decoration {
            position: absolute;
            font-size: 2rem;
            opacity: 0.1;
            pointer-events: none;
        }

        .deco-1 { top: 10%; left: 5%; animation: float 6s ease-in-out infinite; }
        .deco-2 { top: 30%; right: 5%; animation: float 8s ease-in-out infinite reverse; }
        .deco-3 { bottom: 20%; left: 8%; animation: float 7s ease-in-out infinite; }
        .deco-4 { bottom: 10%; right: 10%; animation: float 5s ease-in-out infinite reverse; }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
        }

        /* Responsive */
        @media (max-width: 500px) {
            .game-container {
                border-radius: 15px;
            }
            .header {
                padding: 20px;
            }
            .story-container {
                padding: 25px 20px;
            }
            .choices-container {
                padding: 15px 20px 25px;
            }
            .choice-btn {
                padding: 15px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Floating decorations -->
    <div class="decoration deco-1">üìñ</div>
    <div class="decoration deco-2">‚úèÔ∏è</div>
    <div class="decoration deco-3">üéí</div>
    <div class="decoration deco-4">üåü</div>

    <div class="game-container" id="game-container">
        <header class="header">
            <h1 class="title">La B√∫squeda de la Tarea Perdida</h1>
            <p class="subtitle">[ Una aventura en espa√±ol ]</p>
        </header>
        
        <div class="story-container">
            <p id="story-text">Cargando...</p>
        </div>
        
        <div class="choices-container" id="choices-container">
            <!-- Buttons will be dynamically generated -->
        </div>
    </div>

    <!-- Sound toggle button -->
    <div class="sound-indicator" id="sound-toggle" title="Sonido On/Off">
        <span>üîä</span>
    </div>

    <script>
        // ============================================
        // AUDIO MAP - Placeholder sound effects
        // ============================================
        const audioMap = {
            'sfx_alarm_clock_panic': 'sounds/sfx_alarm_clock_panic.mp3',
            'sfx_dust_cough': 'sounds/sfx_dust_cough.mp3',
            'sfx_gross_smell': 'sounds/sfx_gross_smell.mp3',
            'sfx_mom_hmm': 'sounds/sfx_mom_hmm.mp3',
            'sfx_magic_portal': 'sounds/sfx_magic_portal.mp3',
            'sfx_cheese_squish': 'sounds/sfx_cheese_squish.mp3',
            'sfx_dog_bark': 'sounds/sfx_dog_bark.mp3',
            'sfx_dog_speaks': 'sounds/sfx_dog_speaks.mp3',
            'sfx_spooky_alien': 'sounds/sfx_spooky_alien.mp3',
            'sfx_slip': 'sounds/sfx_slip.mp3',
            'sfx_animal_surprise': 'sounds/sfx_animal_surprise.mp3',
            'sfx_robot_beep': 'sounds/sfx_robot_beep.mp3',
            'sfx_explosion_small': 'sounds/sfx_explosion_small.mp3',
            'sfx_victory': 'sounds/sfx_victory.mp3',
            'sfx_sad_trombone': 'sounds/sfx_sad_trombone.mp3',
            'sfx_dramatic_gasp': 'sounds/sfx_dramatic_gasp.mp3',
            'sfx_kitchen_chaos': 'sounds/sfx_kitchen_chaos.mp3',
            'sfx_happy_dog': 'sounds/sfx_happy_dog.mp3',
            'sfx_mysterious': 'sounds/sfx_mysterious.mp3',
            'sfx_paper_rustle': 'sounds/sfx_paper_rustle.mp3'
        };

        // ============================================
        // STORY DATA - The Complete Adventure!
        // ============================================
        const storyData = {
            // === STARTING POINT ===
            start: {
                id: 'start',
                text: "‚òÄÔ∏è Te despiertas tarde. ¬°Son las 7:45! Buscas tu tarea de espa√±ol en tu mochila pero... ¬°NO EST√Å! üò± La clase empieza en quince minutos. ¬øQu√© haces?",
                soundOnEnter: 'sfx_alarm_clock_panic',
                choices: [
                    { text: "üõèÔ∏è Mirar debajo de la cama", nextNode: 'under_bed' },
                    { text: "üë© Preguntar a mam√°", nextNode: 'ask_mom' },
                    { text: "üêï Preguntar al perro Max", nextNode: 'ask_dog' }
                ]
            },

            // === UNDER THE BED PATH ===
            under_bed: {
                id: 'under_bed',
                text: "üõèÔ∏è Miras debajo de la cama. Hay mucho polvo, un calcet√≠n viejo que huele MUY mal, y... ¬øes eso un agujero brillante en el piso? ¬°Parece un portal m√°gico! üåÄ",
                soundOnEnter: 'sfx_dust_cough',
                choices: [
                    { text: "üß¶ Oler el calcet√≠n (¬øpor qu√©?)", nextNode: 'smell_sock' },
                    { text: "üåÄ Entrar en el portal m√°gico", nextNode: 'cheese_dimension' },
                    { text: "üîô Volver al inicio", nextNode: 'start' }
                ]
            },

            smell_sock: {
                id: 'smell_sock',
                text: "üß¶ Hueles el calcet√≠n viejo. ERROR. ERROR TERRIBLE. ü§¢ El olor es tan fuerte que te desmayas. Cuando despiertas, llegas muy tarde a la escuela. Tu profesor est√° muy enojado.",
                soundOnEnter: 'sfx_gross_smell',
                ending: 'bad',
                choices: [
                    { text: "üò¢ ¬°Oh no! Jugar otra vez", nextNode: 'start' }
                ]
            },

            cheese_dimension: {
                id: 'cheese_dimension',
                text: "üßÄ ¬°WOOOOSH! Entras en el portal y... ¬°est√°s en una dimensi√≥n hecha completamente de QUESO! Las monta√±as son de queso. Los √°rboles son de queso. Un rat√≥n gigante te mira.",
                soundOnEnter: 'sfx_magic_portal',
                choices: [
                    { text: "üê≠ Hablar con el rat√≥n gigante", nextNode: 'talk_mouse' },
                    { text: "üßÄ Comer el suelo de queso", nextNode: 'eat_cheese' }
                ]
            },

            talk_mouse: {
                id: 'talk_mouse',
                text: "üê≠ El rat√≥n gigante dice: '¬°Hola, humano peque√±o! Busco mi tarea tambi√©n. ¬°Fue comida por el Rey Queso!' El rat√≥n se√±ala un castillo de queso cheddar en la distancia.",
                soundOnEnter: 'sfx_animal_surprise',
                choices: [
                    { text: "üè∞ Ir al castillo del Rey Queso", nextNode: 'cheese_castle' },
                    { text: "üîô Volver por el portal", nextNode: 'start' }
                ]
            },

            cheese_castle: {
                id: 'cheese_castle',
                text: "üè∞ En el castillo, el Rey Queso (un queso suizo muy grande con corona) te da TU TAREA. '¬°La encontr√© en el portal!' dice. '¬°Puedes tenerla si bailas!' üíÉ",
                soundOnEnter: 'sfx_cheese_squish',
                choices: [
                    { text: "üíÉ ¬°Bailar para el Rey Queso!", nextNode: 'victory_dance' },
                    { text: "üôÖ No, no bailo", nextNode: 'no_dance' }
                ]
            },

            victory_dance: {
                id: 'victory_dance',
                text: "üéâ ¬°Bailas! El Rey Queso est√° muy feliz. Te da tu tarea Y un trozo de queso m√°gico. Vuelves a casa justo a tiempo para la escuela. ¬°TU PROFESOR EST√Å IMPRESIONADO! üèÜ‚ú®",
                soundOnEnter: 'sfx_victory',
                ending: 'good',
                choices: [
                    { text: "üéä ¬°VICTORIA! Jugar otra vez", nextNode: 'start' }
                ]
            },

            no_dance: {
                id: 'no_dance',
                text: "üò§ El Rey Queso est√° muy ofendido. '¬°GUARDIAS!' grita. Ratones de queso te persiguen fuera de la dimensi√≥n. Pierdes tu tarea para siempre en el queso.",
                soundOnEnter: 'sfx_sad_trombone',
                ending: 'bad',
                choices: [
                    { text: "üßÄ Jugar otra vez", nextNode: 'start' }
                ]
            },

            eat_cheese: {
                id: 'eat_cheese',
                text: "üßÄ Comes el suelo de queso. ¬°Es delicioso! Pero comes demasiado y no puedes moverte. Vives en la dimensi√≥n de queso para siempre. Feliz... pero gordo. üòÖ",
                soundOnEnter: 'sfx_cheese_squish',
                ending: 'bad',
                choices: [
                    { text: "üßÄ Mmm queso... Jugar otra vez", nextNode: 'start' }
                ]
            },

            // === ASK MOM PATH ===
            ask_mom: {
                id: 'ask_mom',
                text: "üë© Vas a la cocina. Mam√° est√° haciendo el desayuno. '¬øTu tarea? Hmm...' ella piensa. 'Creo que la vi en la cocina... o en el ba√±o... o la tiene el robot aspirador.' ü§ñ",
                soundOnEnter: 'sfx_mom_hmm',
                choices: [
                    { text: "üç≥ Buscar en la cocina", nextNode: 'kitchen_search' },
                    { text: "üöø Buscar en el ba√±o", nextNode: 'bathroom_search' },
                    { text: "ü§ñ Encontrar al robot aspirador", nextNode: 'robot_chase' }
                ]
            },

            kitchen_search: {
                id: 'kitchen_search',
                text: "üç≥ Buscas en la cocina. Abres el refrigerador y... ¬°TU TAREA EST√Å CONGELADA EN EL HIELO! üßä Al lado hay una nota: 'Refrigerador equivocado. -Tu hermano peque√±o'",
                soundOnEnter: 'sfx_kitchen_chaos',
                choices: [
                    { text: "üßä Descongelar la tarea r√°pido", nextNode: 'defrost_homework' },
                    { text: "üò° Buscar a tu hermano", nextNode: 'find_brother' }
                ]
            },

            defrost_homework: {
                id: 'defrost_homework',
                text: "üå°Ô∏è Usas el microondas para descongelar la tarea. ¬°BOOM! üí• El microondas explota. Tu tarea ahora es papel quemado. Tu mam√° no est√° feliz.",
                soundOnEnter: 'sfx_explosion_small',
                ending: 'bad',
                choices: [
                    { text: "üí• Ups... Jugar otra vez", nextNode: 'start' }
                ]
            },

            find_brother: {
                id: 'find_brother',
                text: "üë¶ Encuentras a tu hermano. √âl dice: '¬°Lo siento! Pens√© que era un mapa del tesoro.' Te ayuda a descongelar la tarea con cuidado. ¬°Funciona! Llegas a la escuela justo a tiempo. üèÜ",
                soundOnEnter: 'sfx_victory',
                ending: 'good',
                choices: [
                    { text: "üéâ ¬°Hermanos √∫tiles! Jugar otra vez", nextNode: 'start' }
                ]
            },

            bathroom_search: {
                id: 'bathroom_search',
                text: "üöø Vas al ba√±o. El piso est√° mojado. ¬°Resbalas! üõÅ Caes en la ba√±era. Hay un pato de goma. El pato te mira. '¬øBuscas tu tarea?' dice el pato. ¬°¬øEL PATO HABLA?!",
                soundOnEnter: 'sfx_slip',
                choices: [
                    { text: "ü¶Ü Hablar con el pato", nextNode: 'talk_duck' },
                    { text: "üèÉ ¬°CORRER! ¬°El pato habla!", nextNode: 'run_from_duck' }
                ]
            },

            talk_duck: {
                id: 'talk_duck',
                text: "ü¶Ü El pato dice: 'Tu tarea est√° en el jard√≠n. La vi desde la ventana. Ve r√°pido.' El pato te gui√±a un ojo. Muy misterioso. üîÆ",
                soundOnEnter: 'sfx_mysterious',
                choices: [
                    { text: "üå≥ Ir al jard√≠n", nextNode: 'garden_victory' },
                    { text: "ü§î Preguntar m√°s al pato", nextNode: 'duck_wisdom' }
                ]
            },

            duck_wisdom: {
                id: 'duck_wisdom',
                text: "ü¶Ü '¬øM√°s preguntas?' dice el pato. 'El tiempo es precioso, joven estudiante. Tambi√©n, yo soy solo un pato de goma. T√∫ imaginaste todo esto. ¬°Ve al jard√≠n!' üåà",
                soundOnEnter: 'sfx_spooky_alien',
                choices: [
                    { text: "üå≥ ¬°OK! Ir al jard√≠n", nextNode: 'garden_victory' }
                ]
            },

            garden_victory: {
                id: 'garden_victory',
                text: "üå≥ ¬°Corres al jard√≠n y tu tarea est√° all√≠! El viento la llev√≥ anoche. Est√° un poco sucia pero legible. ¬°Llegas a la escuela y tu profesor est√° feliz! üåüüéâ",
                soundOnEnter: 'sfx_victory',
                ending: 'good',
                choices: [
                    { text: "ü¶Ü ¬°Gracias, pato m√°gico! Jugar otra vez", nextNode: 'start' }
                ]
            },

            run_from_duck: {
                id: 'run_from_duck',
                text: "üèÉ Corres del ba√±o gritando '¬°EL PATO HABLA!' Tu familia piensa que est√°s loco. Te llevan al doctor. Pierdes la escuela. El pato r√≠e. ü¶Üüòà",
                soundOnEnter: 'sfx_sad_trombone',
                ending: 'bad',
                choices: [
                    { text: "ü¶Ü Los patos son malvados... Jugar otra vez", nextNode: 'start' }
                ]
            },

            robot_chase: {
                id: 'robot_chase',
                text: "ü§ñ ¬°El robot aspirador tiene tu tarea! Corre por toda la casa. BEEP BOOP BEEP. '¬°DAME MI TAREA!' gritas. El robot va m√°s r√°pido. ¬°Es una persecuci√≥n √©pica!",
                soundOnEnter: 'sfx_robot_beep',
                choices: [
                    { text: "üîå Desconectar el robot", nextNode: 'unplug_robot' },
                    { text: "üç™ Darle una galleta al robot", nextNode: 'cookie_robot' }
                ]
            },

            unplug_robot: {
                id: 'unplug_robot',
                text: "üîå Desconectas el robot. ¬°Pero tu tarea est√° DENTRO del robot! La abres y... est√° destruida en mil pedazos. El robot aspirador come papel. üìÑüíÄ",
                soundOnEnter: 'sfx_sad_trombone',
                ending: 'bad',
                choices: [
                    { text: "ü§ñ Los robots son mis enemigos... Jugar otra vez", nextNode: 'start' }
                ]
            },

            cookie_robot: {
                id: 'cookie_robot',
                text: "üç™ '¬øUna galleta?' dice el robot (¬°¬ølos robots hablan ahora?!). 'Acepto tu ofrenda.' El robot te da tu tarea, perfecta. '¬°Gracias, humano!' ¬°Llegas a tiempo a la escuela! üéä",
                soundOnEnter: 'sfx_victory',
                ending: 'good',
                choices: [
                    { text: "ü§ñüç™ ¬°Los robots aman galletas! Jugar otra vez", nextNode: 'start' }
                ]
            },

            // === ASK DOG PATH ===
            ask_dog: {
                id: 'ask_dog',
                text: "üêï Vas a donde est√° Max, tu perro. 'Max, ¬øviste mi tarea?' Max te mira. Mueve la cola. Y entonces... MAX HABLA: 'S√≠, la vi. Pero primero, tengo preguntas.' üò±üêï",
                soundOnEnter: 'sfx_dog_bark',
                choices: [
                    { text: "üòÆ Escuchar las preguntas de Max", nextNode: 'dog_questions' },
                    { text: "üèÉ ¬°HUIR! ¬°El perro habla!", nextNode: 'run_from_dog' }
                ]
            },

            dog_questions: {
                id: 'dog_questions',
                text: "üêï Max pregunta: '¬øPor qu√© los humanos van a la escuela pero los perros no? ¬øEs justo? Tambi√©n, ¬øpor qu√© mi comida no tiene sabor a bistec todos los d√≠as?' Max espera respuestas.",
                soundOnEnter: 'sfx_dog_speaks',
                choices: [
                    { text: "üéì 'Los perros pueden ir a la escuela tambi√©n'", nextNode: 'dog_school' },
                    { text: "ü•© 'Te comprar√© comida de bistec'", nextNode: 'steak_promise' }
                ]
            },

            dog_school: {
                id: 'dog_school',
                text: "üêïüéì Max est√° EMOCIONADO. '¬°¬øEN SERIO?!' Max corre, trae tu tarea del jard√≠n (√©l la escondi√≥), y te sigue a la escuela. Tu profesor deja que Max se quede. ¬°D√≠a perfecto! üèÜ",
                soundOnEnter: 'sfx_victory',
                ending: 'good',
                choices: [
                    { text: "üêï ¬°Max es el mejor! Jugar otra vez", nextNode: 'start' }
                ]
            },

            steak_promise: {
                id: 'steak_promise',
                text: "ü•© Max salta de alegr√≠a. '¬°TRATO!' Te muestra d√≥nde est√° tu tarea: bajo su cama de perro. Llegas a tiempo a la escuela. Pero ahora debes comprar bistec. Mucho bistec. ü•©üèÜ",
                soundOnEnter: 'sfx_happy_dog',
                ending: 'good',
                choices: [
                    { text: "ü•© ¬°Victoria costosa! Jugar otra vez", nextNode: 'start' }
                ]
            },

            run_from_dog: {
                id: 'run_from_dog',
                text: "üèÉ ¬°Corres de Max! Max est√° confundido y triste. '¬°Solo quer√≠a ayudar!' llora el perro. Ahora Max no te habla. Y nunca encuentras tu tarea. Max la escondi√≥ bien. üò¢üêï",
                soundOnEnter: 'sfx_sad_trombone',
                ending: 'bad',
                choices: [
                    { text: "üêï Pobre Max... Jugar otra vez", nextNode: 'start' }
                ]
            }
        };

        // ============================================
        // GAME ENGINE
        // ============================================
        
        let soundEnabled = true;
        const storyTextEl = document.getElementById('story-text');
        const choicesContainerEl = document.getElementById('choices-container');
        const gameContainerEl = document.getElementById('game-container');
        const soundToggleEl = document.getElementById('sound-toggle');

        // Play sound effect (placeholder - logs to console)
        function playSound(soundId) {
            if (!soundEnabled) return;
            
            const soundPath = audioMap[soundId];
            if (soundPath) {
                // In a real implementation, you would play the audio:
                // const audio = new Audio(soundPath);
                // audio.play();
                
                // For demo purposes, log the sound:
                console.log(`üîä Playing sound: ${soundId} (${soundPath})`);
            }
        }

        // Toggle sound
        soundToggleEl.addEventListener('click', () => {
            soundEnabled = !soundEnabled;
            soundToggleEl.querySelector('span').textContent = soundEnabled ? 'üîä' : 'üîá';
        });

        // Main render function
        function showNode(nodeId) {
            const node = storyData[nodeId];
            
            if (!node) {
                console.error(`Node not found: ${nodeId}`);
                return;
            }

            // Remove ending classes
            gameContainerEl.classList.remove('ending-bad', 'ending-good');

            // Add ending class if applicable
            if (node.ending === 'bad') {
                gameContainerEl.classList.add('ending-bad');
            } else if (node.ending === 'good') {
                gameContainerEl.classList.add('ending-good');
            }

            // Update story text with animation
            storyTextEl.style.animation = 'none';
            storyTextEl.offsetHeight; // Trigger reflow
            storyTextEl.style.animation = 'text-appear 0.5s ease-out';
            storyTextEl.textContent = node.text;

            // Clear and generate new choice buttons
            choicesContainerEl.innerHTML = '';
            
            node.choices.forEach((choice, index) => {
                const button = document.createElement('button');
                button.className = 'choice-btn';
                button.textContent = choice.text;
                button.style.animationDelay = `${index * 0.1}s`;
                
                button.addEventListener('click', () => {
                    showNode(choice.nextNode);
                });
                
                // Add entrance animation
                button.style.opacity = '0';
                button.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    button.style.transition = 'all 0.3s ease';
                    button.style.opacity = '1';
                    button.style.transform = 'translateY(0)';
                }, 100 + (index * 100));
                
                choicesContainerEl.appendChild(button);
            });

            // Play sound effect
            if (node.soundOnEnter) {
                playSound(node.soundOnEnter);
            }
        }

        // Initialize the game
        document.addEventListener('DOMContentLoaded', () => {
            showNode('start');
        });

        // Also start immediately in case DOM is already loaded
        if (document.readyState !== 'loading') {
            showNode('start');
        }
    </script>
</body>
</html>
